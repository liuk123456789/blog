(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{446:function(s,t,a){"use strict";a.r(t);var n=a(2),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"_1-前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言"}},[s._v("#")]),s._v(" 1. 前言")]),s._v(" "),t("p",[s._v("项目中使用的包出现问题，提了issue，但是开源作者无发版/patch计划，我们项目急着上线，那么这时候我们可以通过patch-package对源码打补丁方式进行应急")]),s._v(" "),t("h3",{attrs:{id:"_2-如何使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何使用"}},[s._v("#")]),s._v(" 2. 如何使用")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("安装patch-package")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("npm i patch-package postinstall-postinstall "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save-dev")]),s._v("\n\nor\n\nyarn add patch-package postinstall-postinstall\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改package.json文件")]),s._v(" "),t("p",[s._v("package.json的scripts中声明了一系列的npm脚本命令，如下：（参考资料："),t("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//caibaojian.com/npm/misc/scripts.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://caibaojian.com/npm/misc/scripts.html"),t("OutboundLink")],1),s._v("）")]),s._v(" "),t("ul",[t("li",[s._v("prepublish: 在包发布之前运行，也会在npm install安装到本地时运行")]),s._v(" "),t("li",[s._v("publish,postpublish: 包被发布之后运行")]),s._v(" "),t("li",[s._v("preinstall: 包被安装前运行")]),s._v(" "),t("li",[s._v("install,postinstall: 包被安装后运行")]),s._v(" "),t("li",[s._v("preuninstall,uninstall: 包被卸载前运行")]),s._v(" "),t("li",[s._v("postuninstall: 包被卸载后运行")]),s._v(" "),t("li",[s._v("preversion: bump包版本前运行")]),s._v(" "),t("li",[s._v("postversion: bump包版本后运行")]),s._v(" "),t("li",[s._v("pretest,test,posttest: 通过npm test命令运行")]),s._v(" "),t("li",[s._v("prestop,stop,poststop: 通过npm stop命令运行")]),s._v(" "),t("li",[s._v("prestart,start,poststart: 通过npm start命令运行")]),s._v(" "),t("li",[s._v("prerestart,restart,postrestart: 通过npm restart运行")])]),s._v(" "),t("p",[s._v("可以看到依赖包在安装完之后会执行postinstall命令")]),s._v(" "),t("p",[s._v('所以我们在package.json的scripts里面增加："postinstall": "patch-package"')]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   ***\n   "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"postinstall"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch-package"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("修改依赖包源码")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" presetsCDN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'mdi'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.unpkg.com/@mdi/font@6.6.96/css/materialdesignicons.min.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'md'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://fonts.googleapis.com/css?family=Material+Icons'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'fa'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'fa4'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("生成补丁")]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("yarn patch-package package-name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("修改的包名）\n\nor\n\nnpx patch-package package-name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("修改的包名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("生成补丁文件")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("git a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node_modules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@nuxtjs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vuetify"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("icons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node_modules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@nuxtjs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vuetify"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("icons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\nindex 913b185"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("67e3a7d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100644")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node_modules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@nuxtjs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vuetify"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("icons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node_modules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@nuxtjs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vuetify"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("icons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n@@ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" @@\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" presetsCDN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mdi'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mdi'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.unpkg.com/@mdi/font@6.6.96/css/materialdesignicons.min.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'md'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://fonts.googleapis.com/css?family=Material+Icons'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'fa'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'fa4'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css'")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_3-问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-问题"}},[s._v("#")]),s._v(" 3. 问题")]),s._v(" "),t("ol",[t("li",[s._v("只针对于当前包版本执行补丁，如果升级包，那么无效")]),s._v(" "),t("li",[s._v("当前版本包如果升级，那么补丁不会生效，除非个人永远不升级")]),s._v(" "),t("li",[s._v("此方案用于应急场景，最有的解决方案还是在源代码上pull request")])])])}),[],!1,null,null,null);t.default=r.exports}}]);