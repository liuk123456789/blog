<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack系列-第二篇</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/my-blog/favicon.ico">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.5d6174b8.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.32be202e.js" as="script"><link rel="preload" href="/my-blog/assets/js/3.a0eaa787.js" as="script"><link rel="preload" href="/my-blog/assets/js/1.f46f4f66.js" as="script"><link rel="preload" href="/my-blog/assets/js/17.3fa23e44.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.d6af31bc.js"><link rel="prefetch" href="/my-blog/assets/js/100.27c20759.js"><link rel="prefetch" href="/my-blog/assets/js/101.cddb3339.js"><link rel="prefetch" href="/my-blog/assets/js/11.26feaf4f.js"><link rel="prefetch" href="/my-blog/assets/js/12.73c5de2a.js"><link rel="prefetch" href="/my-blog/assets/js/13.cea3cbf2.js"><link rel="prefetch" href="/my-blog/assets/js/14.47539c67.js"><link rel="prefetch" href="/my-blog/assets/js/15.25455bcd.js"><link rel="prefetch" href="/my-blog/assets/js/16.81dc735f.js"><link rel="prefetch" href="/my-blog/assets/js/18.bea49075.js"><link rel="prefetch" href="/my-blog/assets/js/19.0002a8d7.js"><link rel="prefetch" href="/my-blog/assets/js/20.fcc72e3d.js"><link rel="prefetch" href="/my-blog/assets/js/21.a1f59723.js"><link rel="prefetch" href="/my-blog/assets/js/22.de87bf53.js"><link rel="prefetch" href="/my-blog/assets/js/23.8cd9339b.js"><link rel="prefetch" href="/my-blog/assets/js/24.3db14a3d.js"><link rel="prefetch" href="/my-blog/assets/js/25.744fa5db.js"><link rel="prefetch" href="/my-blog/assets/js/26.3e0e53c0.js"><link rel="prefetch" href="/my-blog/assets/js/27.b6f44027.js"><link rel="prefetch" href="/my-blog/assets/js/28.c970796c.js"><link rel="prefetch" href="/my-blog/assets/js/29.e4674ee9.js"><link rel="prefetch" href="/my-blog/assets/js/30.141008aa.js"><link rel="prefetch" href="/my-blog/assets/js/31.ef5b99f3.js"><link rel="prefetch" href="/my-blog/assets/js/32.d134be95.js"><link rel="prefetch" href="/my-blog/assets/js/33.5b000d47.js"><link rel="prefetch" href="/my-blog/assets/js/34.bca35313.js"><link rel="prefetch" href="/my-blog/assets/js/35.c9d706bf.js"><link rel="prefetch" href="/my-blog/assets/js/36.b437ed1a.js"><link rel="prefetch" href="/my-blog/assets/js/37.e86ae065.js"><link rel="prefetch" href="/my-blog/assets/js/38.6a9b4673.js"><link rel="prefetch" href="/my-blog/assets/js/39.590649cf.js"><link rel="prefetch" href="/my-blog/assets/js/4.bb59c7a2.js"><link rel="prefetch" href="/my-blog/assets/js/40.41cede96.js"><link rel="prefetch" href="/my-blog/assets/js/41.6d8d864d.js"><link rel="prefetch" href="/my-blog/assets/js/42.94936add.js"><link rel="prefetch" href="/my-blog/assets/js/43.e8f1f6c8.js"><link rel="prefetch" href="/my-blog/assets/js/44.4818b939.js"><link rel="prefetch" href="/my-blog/assets/js/45.f16377b8.js"><link rel="prefetch" href="/my-blog/assets/js/46.8daeb3ae.js"><link rel="prefetch" href="/my-blog/assets/js/47.a117cb87.js"><link rel="prefetch" href="/my-blog/assets/js/48.c5860bd4.js"><link rel="prefetch" href="/my-blog/assets/js/49.dfd40b01.js"><link rel="prefetch" href="/my-blog/assets/js/5.773d3189.js"><link rel="prefetch" href="/my-blog/assets/js/50.31bbeafa.js"><link rel="prefetch" href="/my-blog/assets/js/51.ab2c25ee.js"><link rel="prefetch" href="/my-blog/assets/js/52.c3e9f72a.js"><link rel="prefetch" href="/my-blog/assets/js/53.31ad3196.js"><link rel="prefetch" href="/my-blog/assets/js/54.bc937597.js"><link rel="prefetch" href="/my-blog/assets/js/55.a1fbff76.js"><link rel="prefetch" href="/my-blog/assets/js/56.8f009313.js"><link rel="prefetch" href="/my-blog/assets/js/57.bb11633c.js"><link rel="prefetch" href="/my-blog/assets/js/58.b1bb562e.js"><link rel="prefetch" href="/my-blog/assets/js/59.f87e0e56.js"><link rel="prefetch" href="/my-blog/assets/js/6.353538f7.js"><link rel="prefetch" href="/my-blog/assets/js/60.dfe5fc39.js"><link rel="prefetch" href="/my-blog/assets/js/61.a829790e.js"><link rel="prefetch" href="/my-blog/assets/js/62.686739ad.js"><link rel="prefetch" href="/my-blog/assets/js/63.bbedd1e1.js"><link rel="prefetch" href="/my-blog/assets/js/64.636aef4f.js"><link rel="prefetch" href="/my-blog/assets/js/65.139d5a5c.js"><link rel="prefetch" href="/my-blog/assets/js/66.dd6ee5ae.js"><link rel="prefetch" href="/my-blog/assets/js/67.e0d2ee76.js"><link rel="prefetch" href="/my-blog/assets/js/68.f622218a.js"><link rel="prefetch" href="/my-blog/assets/js/69.c0909036.js"><link rel="prefetch" href="/my-blog/assets/js/7.57ae79a3.js"><link rel="prefetch" href="/my-blog/assets/js/70.52ee9a86.js"><link rel="prefetch" href="/my-blog/assets/js/71.7471b31c.js"><link rel="prefetch" href="/my-blog/assets/js/72.0e2e2183.js"><link rel="prefetch" href="/my-blog/assets/js/73.b273bfc6.js"><link rel="prefetch" href="/my-blog/assets/js/74.015cb3a1.js"><link rel="prefetch" href="/my-blog/assets/js/75.d4b5c87b.js"><link rel="prefetch" href="/my-blog/assets/js/76.7d119663.js"><link rel="prefetch" href="/my-blog/assets/js/77.954ed03b.js"><link rel="prefetch" href="/my-blog/assets/js/78.5a078583.js"><link rel="prefetch" href="/my-blog/assets/js/79.351139e1.js"><link rel="prefetch" href="/my-blog/assets/js/8.55fa6f4d.js"><link rel="prefetch" href="/my-blog/assets/js/80.5d5f4b1e.js"><link rel="prefetch" href="/my-blog/assets/js/81.b720117f.js"><link rel="prefetch" href="/my-blog/assets/js/82.57c80203.js"><link rel="prefetch" href="/my-blog/assets/js/83.ebe18815.js"><link rel="prefetch" href="/my-blog/assets/js/84.83e42ca6.js"><link rel="prefetch" href="/my-blog/assets/js/85.7fcb0c21.js"><link rel="prefetch" href="/my-blog/assets/js/86.cc9b45c7.js"><link rel="prefetch" href="/my-blog/assets/js/87.579c23d5.js"><link rel="prefetch" href="/my-blog/assets/js/88.75d9615b.js"><link rel="prefetch" href="/my-blog/assets/js/89.ab3c9f8f.js"><link rel="prefetch" href="/my-blog/assets/js/9.96f51beb.js"><link rel="prefetch" href="/my-blog/assets/js/90.fb273928.js"><link rel="prefetch" href="/my-blog/assets/js/91.0f6e5009.js"><link rel="prefetch" href="/my-blog/assets/js/92.89770dba.js"><link rel="prefetch" href="/my-blog/assets/js/93.81087123.js"><link rel="prefetch" href="/my-blog/assets/js/94.0280bab1.js"><link rel="prefetch" href="/my-blog/assets/js/95.df83fca0.js"><link rel="prefetch" href="/my-blog/assets/js/96.14f4f56c.js"><link rel="prefetch" href="/my-blog/assets/js/97.6ebc8243.js"><link rel="prefetch" href="/my-blog/assets/js/98.dd2e6180.js"><link rel="prefetch" href="/my-blog/assets/js/99.2c402d96.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.5d6174b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <p class="description" data-v-59e6cb88></p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>科纳</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><img src="/my-blog/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/CI/" class="nav-link"><i class="undefined"></i>
  CI
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Design Partten/" class="nav-link"><i class="undefined"></i>
  Design Partten
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/ES6/" class="nav-link"><i class="undefined"></i>
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/日常整理/" class="nav-link"><i class="undefined"></i>
  日常整理
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Rollup/" class="nav-link"><i class="undefined"></i>
  Rollup
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Sass/" class="nav-link"><i class="undefined"></i>
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/源码解读/" class="nav-link"><i class="undefined"></i>
  源码解读
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/TypeScript/" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/my-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      相关链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuk123456789/blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/my-blog/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    科纳
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>91</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>85</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/CI/" class="nav-link"><i class="undefined"></i>
  CI
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Design Partten/" class="nav-link"><i class="undefined"></i>
  Design Partten
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/ES6/" class="nav-link"><i class="undefined"></i>
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/日常整理/" class="nav-link"><i class="undefined"></i>
  日常整理
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Rollup/" class="nav-link"><i class="undefined"></i>
  Rollup
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Sass/" class="nav-link"><i class="undefined"></i>
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/源码解读/" class="nav-link"><i class="undefined"></i>
  源码解读
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/TypeScript/" class="nav-link"><i class="undefined"></i>
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/my-blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      相关链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuk123456789/blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/blogs/Webpack/basic.html" class="sidebar-link">webpack系列-第一篇</a></li><li><a href="/my-blog/blogs/Webpack/custom.html" class="sidebar-link">webpack系列-第四篇</a></li><li><a href="/my-blog/blogs/Webpack/mf.html" class="sidebar-link">webpack系列-第六篇</a></li><li><a href="/my-blog/blogs/Webpack/performance.html" aria-current="page" class="active sidebar-link">webpack系列-第二篇</a></li><li><a href="/my-blog/blogs/Webpack/theory.html" class="sidebar-link">webpack系列-第三篇</a></li><li><a href="/my-blog/blogs/Webpack/webpack-chain.html" class="sidebar-link">webpack系列-第五篇</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>webpack系列-第二篇</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>科纳</span>
          
        <span data-v-59e6cb88>2018 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">webpack系列-第二篇</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>科纳</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>5/4/2023</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/my-blog/blogs/Webpack/performance.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>webpack 第二篇</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-前言"><a href="#_1-前言" class="header-anchor">#</a> 1. 前言</h2> <p>本篇主要就是<code>webpack</code>打包优化方面</p> <h2 id="_2-构建进度美化"><a href="#_2-构建进度美化" class="header-anchor">#</a> 2. 构建进度美化</h2> <ol><li><p>依赖安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> webpackbar <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改<code>webpack.base.ts</code>配置</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> WebpackBar <span class="token keyword">from</span> <span class="token string">'webpackbar'</span>

<span class="token keyword">const</span> webpackBaseConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token punctuation">{</span>
    stats<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token string">'errors-only'</span> <span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">WebpackBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      		color<span class="token operator">:</span> <span class="token string">'#3E68FF'</span><span class="token punctuation">,</span>
      		basic<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      		profile<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>本来打算使用<code>friendly-errors-webpack-plugin</code>，但是目前不支持<code>webpack5.x</code>，所以配置了<code>stats</code></p> <h4 id="stats-presets"><a href="#stats-presets" class="header-anchor">#</a> Stats Presets</h4> <p><code>webpack</code> 有一些特定的预设选项给统计信息输出：</p> <table><thead><tr><th style="text-align:left;">预设</th> <th style="text-align:left;">可选值</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>'errors-only'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">只在发生错误时输出</td></tr> <tr><td style="text-align:left;"><code>'errors-warnings'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">只在发生错误或有警告时输出</td></tr> <tr><td style="text-align:left;"><code>'minimal'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">只在发生错误或新的编译开始时输出</td></tr> <tr><td style="text-align:left;"><code>'none'</code></td> <td style="text-align:left;"><code>false</code></td> <td style="text-align:left;">没有输出</td></tr> <tr><td style="text-align:left;"><code>'normal'</code></td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">标准输出</td></tr> <tr><td style="text-align:left;"><code>'verbose'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">全部输出</td></tr> <tr><td style="text-align:left;"><code>'detailed'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">全部输出除了 <code>chunkModules</code> 和 <code>chunkRootModules</code></td></tr> <tr><td style="text-align:left;"><code>'summary'</code></td> <td style="text-align:left;"><em>none</em></td> <td style="text-align:left;">输出<code>webpack</code> 版本，以及警告数和错误数</td></tr></tbody></table></li></ol> <h2 id="_3-持久化缓存"><a href="#_3-持久化缓存" class="header-anchor">#</a> 3. 持久化缓存</h2> <p><code>webpack5</code>之前通常使用<code>cache-loader</code>进行缓存配置，还有模块缓存插件<code>hard-source-webpack-plugin</code>，配置好缓存后第二次打包，通过对文件做哈希对比来验证文件前后是否一致，如果一致则采用上一次的缓存，可以极大地节省时间。</p> <p><code>webpack5</code> 较于 <code>webpack4</code>，新增了持久化缓存、改进缓存算法等优化，通过配置 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fcache%2F%23root" target="_blank" rel="noopener noreferrer">webpack 持久化缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，来缓存生成的 <code>webpack</code> 模块和 <code>chunk</code>，改善下一次打包的构建速度,可提速 <code>90%</code> 左右,配置也简单，修改<code>webpack.base.ts</code>：</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> webpackBaseConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token punctuation">{</span>
    cache<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'filesystem'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-include-exclude-缩小构建目标"><a href="#_4-include-exclude-缩小构建目标" class="header-anchor">#</a> 4. include&amp;exclude 缩小构建目标</h2> <p>修改下<code>webpack.base.ts</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// babel</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token function-variable function">exclude</span><span class="token operator">:</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ts</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(ts|tsx)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token function">generateCssLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg|bmp)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token comment">// 小于30kb 转 base64</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'images/[hash][ext][query]'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(woff2?|eot|ttf|otf)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 匹配字体图标文件</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span> <span class="token comment">// type选择asset</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'fonts/[hash][ext][query]'</span> <span class="token comment">// 文件输出目录和命名</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(mp4|webm|ogg|mp3|wav|flac|aac)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 匹配媒体文件</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span> <span class="token comment">// type选择asset</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'media/[hash][ext][query]'</span> <span class="token comment">// 文件输出目录和命名</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 匹配json文件</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.json$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'asset/resource'</span><span class="token punctuation">,</span> <span class="token comment">// 将json文件视为文件类型</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 这里专门针对json文件的处理</span>
          filename<span class="token operator">:</span> <span class="token string">'json/[name].[hash][ext][query]'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="_5-devtools配置"><a href="#_5-devtools配置" class="header-anchor">#</a> 5. devtools配置</h2> <p>开发过程中或者打包后的代码都是<code>webpack</code>处理后的代码，如果进行调试肯定希望看到源代码，而不是编译后的代码，<code>source map</code>就是用来做源码映射的，不同的映射模式会明显影响到构建和重新构建的速度，<code>devtool</code>选项就是<code>webpack</code>提供的选择源码映射方式的配置。</p> <p><code>devtool</code>的命名规则为：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>^<span class="token punctuation">(</span>inline-<span class="token operator">|</span>hidden-<span class="token operator">|</span>eval-<span class="token punctuation">)</span>?<span class="token punctuation">(</span>nosources-<span class="token punctuation">)</span>?<span class="token punctuation">(</span>cheap-<span class="token punctuation">(</span>module-<span class="token punctuation">)</span>?<span class="token punctuation">)</span>?source-map$
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><table><thead><tr><th>关键字</th> <th>描述</th></tr></thead> <tbody><tr><td><code>inline</code></td> <td>代码内通过 <code>dataUrl</code> 形式引入 <code>SourceMap</code></td></tr> <tr><td><code>hidden</code></td> <td>生成 <code>SourceMap</code> 文件,但不使用</td></tr> <tr><td><code>eval</code></td> <td><code>eval(...)</code> 形式执行代码,通过 <code>dataUrl</code> 形式引入 <code>SourceMap</code></td></tr> <tr><td><code>nosources</code></td> <td>不生成 <code>SourceMap</code></td></tr> <tr><td><code>cheap</code></td> <td>只需要定位到行信息,不需要列信息</td></tr> <tr><td><code>module</code></td> <td>展示源代码中的错误位置</td></tr></tbody></table> <p>开发环境推荐：<code>eval-cheap-module-source-map</code></p> <ul><li>本地开发首次打包慢点没关系，因为 <code>eval</code> 缓存的原因，热更新会很快</li> <li>开发中，我们每行代码不会写的太长，只需要定位到行就行，所以加上 <code>cheap</code></li> <li>我们希望能够找到源代码的错误，而不是打包后的，所以需要加上 <code>module</code></li></ul> <p>修改下<code>webpack.dev.ts</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> webpackDevConfig<span class="token operator">:</span> WebpackDevConfiguraion <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackBaseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token comment">// devtool配置</span>
  devtool<span class="token operator">:</span> <span class="token string">'eval-cheap-module-source-map'</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">9527</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// history 404</span>
    setupExitSignals<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许SIGINT和SIGTERM信号关闭开发服务器和退出进程</span>
    <span class="token keyword">static</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      directory<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../public'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> WebpackDevConfiguraion

<span class="token keyword">export</span> <span class="token keyword">default</span> webpackDevConfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_6-打包体积分析"><a href="#_6-打包体积分析" class="header-anchor">#</a> 6. 打包体积分析</h2> <ol><li><p>依赖安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> webpack-bundle-analyzer <span class="token parameter variable">-D</span>
<span class="token function">pnpm</span> <span class="token function">install</span> @types/webpack-bundle-analyzer <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>新建个<code>webpack.analy.ts</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> webpackProConfig <span class="token keyword">from</span> <span class="token string">&quot;./webpack.prod&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'webpack-bundle-analyzer'</span>

<span class="token keyword">const</span> webpackAnalyConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackProConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 配置分析打包结果插件</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> webpackAnalyConfig<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>新加脚本</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:analy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production BASE_ENV=pro webpack -c build/webpack.analy.ts&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>执行<code>pnpm run build:analy</code></p></li></ol> <h2 id="_7-css抽离-压缩"><a href="#_7-css抽离-压缩" class="header-anchor">#</a> 7. css抽离&amp;压缩</h2> <ol><li><p>依赖安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> mini-css-extract-plugin css-minimizer-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>开发环境使用的是<code>style-loader</code>，而生产环境我们抽离<code>css</code></p> <p>修改下<code>build/utils</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

<span class="token keyword">const</span> styleLoadersArray <span class="token operator">=</span> <span class="token punctuation">[</span>
  isDev <span class="token operator">?</span> <span class="token string">'style-loader'</span> <span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
  <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
  <span class="token string">'postcss-loader'</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>修改下<code>webpack.prod.ts</code>进行样式抽离</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> MiniCssExtractPlugin <span class="token keyword">from</span> <span class="token string">'mini-css-extract-plugin'</span>

<span class="token keyword">const</span> webpackProdConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackBaseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'css/[name].[contenthash:8].css'</span> <span class="token comment">// 抽离css的输出目录和名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>修改下<code>webpack.prod.ts</code>进行样式压缩</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ...</span>
<span class="token keyword">import</span> CssMinimizerPlugin <span class="token keyword">from</span> <span class="token string">'css-minimizer-webpack-plugin'</span>

<span class="token keyword">const</span> webpackProdConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackBaseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CssMinimizerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩css</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'css/[name].[contenthash:8].css'</span> <span class="token comment">// 抽离css的输出目录和名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ol> <h2 id="_8-js压缩"><a href="#_8-js压缩" class="header-anchor">#</a> 8. js压缩</h2> <p>设置mode为production时,webpack会使用内置插件<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fterser-webpack-plugin" target="_blank" rel="noopener noreferrer">terser-webpack-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>压缩js文件,该插件默认支持多线程压缩,但是上面配置optimization.minimizer压缩css后,js压缩就失效了,需要手动再添加一下,webpack内部安装了该插件,由于pnpm解决了幽灵依赖问题,如果用的pnpm的话,需要手动再安装一下依赖。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> terser-webpack-plugin compression-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改<code>webpack.prod.ts</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Configuration <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'webpack'</span>

<span class="token keyword">import</span> merge <span class="token keyword">from</span> <span class="token string">'webpack-merge'</span>

<span class="token keyword">import</span> webpackBaseConfig <span class="token keyword">from</span> <span class="token string">'./webpack.base'</span>

<span class="token keyword">import</span> CopyPlugin <span class="token keyword">from</span> <span class="token string">'copy-webpack-plugin'</span>
<span class="token keyword">import</span> MiniCssExtractPlugin <span class="token keyword">from</span> <span class="token string">'mini-css-extract-plugin'</span>
<span class="token keyword">import</span> CssMinimizerPlugin <span class="token keyword">from</span> <span class="token string">'css-minimizer-webpack-plugin'</span>
<span class="token keyword">import</span> TerserPlugin <span class="token keyword">from</span> <span class="token string">'terser-webpack-plugin'</span>
<span class="token keyword">import</span> CompressionPlugin <span class="token keyword">from</span> <span class="token string">'compression-webpack-plugin'</span>

<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">const</span> webpackProdConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackBaseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 分隔代码</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 提取node_modules代码</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 只匹配node_modules里面的模块</span>
          name<span class="token operator">:</span> <span class="token string">'vendors'</span><span class="token punctuation">,</span> <span class="token comment">// 提取文件命名为vendors,js后缀和chunkhash会自动加</span>
          minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 只要使用一次就提取出来</span>
          chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span> <span class="token comment">// 只提取初始化就能获取到的模块,不管异步的</span>
          minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 提取代码体积大于0就提取出来</span>
          priority<span class="token operator">:</span> <span class="token number">1</span> <span class="token comment">// 提取优先级为1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        commons<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 提取页面公共代码</span>
          name<span class="token operator">:</span> <span class="token string">'commons'</span><span class="token punctuation">,</span> <span class="token comment">// 提取文件命名为commons</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 只要使用两次就提取出来</span>
          chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span> <span class="token comment">// 只提取初始化就能获取到的模块,不管异步的</span>
          minSize<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 提取代码体积大于0就提取出来</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    runtimeChunk<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'mainifels'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CssMinimizerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩css</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启多线程压缩</span>
        terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          compress<span class="token operator">:</span> <span class="token punctuation">{</span>
            pure_funcs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'console.log'</span><span class="token punctuation">]</span> <span class="token comment">// 删除console.log</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  performance<span class="token operator">:</span> <span class="token punctuation">{</span>
    hints<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    maxAssetSize<span class="token operator">:</span> <span class="token number">4000000</span><span class="token punctuation">,</span> <span class="token comment">// 整数类型（以字节为单位）</span>
    maxEntrypointSize<span class="token operator">:</span> <span class="token number">5000000</span> <span class="token comment">// 整数类型（以字节为单位）</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      patterns<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          from<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>source<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'css/[name].[contenthash:8].css'</span> <span class="token comment">// 抽离css的输出目录和名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包时生成gzip文件</span>
    <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|css)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 只生成css,js压缩文件</span>
      filename<span class="token operator">:</span> <span class="token string">'[path][base].gz'</span><span class="token punctuation">,</span> <span class="token comment">// 文件命名</span>
      algorithm<span class="token operator">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span> <span class="token comment">// 压缩格式,默认是gzip</span>
      threshold<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span> <span class="token comment">// 只有大小大于该值的资源会被处理。默认值是 10k</span>
      minRatio<span class="token operator">:</span> <span class="token number">0.8</span> <span class="token comment">// 压缩率,默认值是 0.8</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> webpackProdConfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h2 id="_9-文件指纹"><a href="#_9-文件指纹" class="header-anchor">#</a> 9. 文件指纹</h2> <p>项目维护的时候，一般只会修改一部分代码，可以合理配置文件缓存，来提升前端加载页面速度和减少服务器压力，而 <code>hash</code> 就是浏览器缓存策略很重要的一部分。<code>webpack</code> 打包的 <code>hash</code> 分三种：</p> <ul><li><code>hash</code>：跟整个项目的构建相关，只要项目里有文件更改，整个项目构建的 <code>hash</code> 值都会更改，并且全部文件都共用相同的 <code>hash</code> 值</li> <li><code>chunkhash</code>：不同的入口文件进行依赖文件解析、构建对应的<code>chunk</code>，生成对应的哈希值，文件本身修改或者依赖文件修改，<code>chunkhash</code> 值会变化</li> <li><code>contenthash</code>：每个文件自己单独的 <code>hash</code> 值，文件的改动只会影响自身的 <code>hash</code> 值</li></ul> <p><code>hash</code> 是在输出文件时配置的，格式是 <code>filename: &quot;[name].[chunkhash:8][ext]&quot;</code>，<code>[xx]</code> 格式是 <code>webpack</code> 提供的占位符，<code>:8</code> 是生成 <code>hash</code> 的长度。</p> <p>修改下<code>webpack.base.ts</code>更改静态资源<code>hash</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> webpackBaseConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/main.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  stats<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token string">'errors-only'</span> <span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg|bmp)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token comment">// 小于30kb 转 base64</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'images/[name].[contenthash:8].[ext]'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(woff2?|eot|ttf|otf)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 匹配字体图标文件</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span> <span class="token comment">// type选择asset</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'fonts/[name].[contenthash:8][ext]'</span> <span class="token comment">// 文件输出目录和命名</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(mp4|webm|ogg|mp3|wav|flac|aac)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 匹配媒体文件</span>
        type<span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span> <span class="token comment">// type选择asset</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">'media/[name].[contenthash:8][ext]'</span> <span class="token comment">// 文件输出目录和命名</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 匹配json文件</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.json$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'asset/resource'</span><span class="token punctuation">,</span> <span class="token comment">// 将json文件视为文件类型</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 这里专门针对json文件的处理</span>
          filename<span class="token operator">:</span> <span class="token string">'json/[name].[contenthash:8][ext]'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>修改<code>webpakc.prod.ts</code>更改<code>css</code>的<code>hash</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> webpackProdConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackBaseConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...  </span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'css/[name].[contenthash:8].css'</span> <span class="token comment">// 抽离css的输出目录和名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_10-代码分割splitchunk"><a href="#_10-代码分割splitchunk" class="header-anchor">#</a> 10. 代码分割splitChunk</h2> <h3 id="webpack-chunk分包原理"><a href="#webpack-chunk分包原理" class="header-anchor">#</a> webpack chunk分包原理</h3> <ul><li>同一个entry入口模块与它的同步依赖组织成一个chunk,还包括runtime（webpackBootstrap 自执行函数的形式）</li> <li>每一个<strong>异步模块</strong>与它的同步依赖单独组成一个 chunk。其中只会包含<strong>入口 chunk 中不存在的同步依赖</strong>；若存在同步第三方包，也会被单独打包成一个 chunk。</li></ul> <p>那么，<code>SplitChunksPlugin</code> 就是在这个基础上再做优化了，也就是对这些 chunk 进行进一步的组合/分割。</p> <h3 id="why-how-为何要代码分割以及如何分割"><a href="#why-how-为何要代码分割以及如何分割" class="header-anchor">#</a> why &amp; how? 为何要代码分割以及如何分割</h3> <p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fcode-splitting%2F" target="_blank" rel="noopener noreferrer">Code Splitting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 拆包优化的最终目标是什么？无非是：</p> <ol><li>把更新频率低的代码和内容频繁变动的代码分离，把共用率较高的资源也拆出来，最大限度利用浏览器缓存。</li> <li>减少 http 请求次数的同时避免单个文件太大以免拖垮响应速度，也就是拆包时尽量实现<code>文件个数更少</code>、<code>单个文件体积更小</code>。</li></ol> <p>第二点的两个目标是互相矛盾的，因此要达到两者之间的平衡是个<strong>博弈</strong>的过程，没有太绝对的拆包策略，都是力求提高性能水准罢了。</p> <p>具体来说，比如一些第三方插件，更新频率其实很低，单个体积通常又较小，就很适合打包在一个文件里。而 <code>UI 组件库</code>更新少的同时体积却比较大，就可以单独打成一个包(也有直接用 <code>CDN</code>外链的)。还有开发者写的公共组件，一般写完后修改也不多，适合拎出来放一个文件。</p> <p><code>webpack</code> 配置<code>output.filename</code>或<code>output.chunkFilename</code>值中的**[contenthash]<strong>使得重新打包时若<code>chunk</code>内容没有变化，就跳过直接使用缓存，当然对应的输出文件名称中的 <code>hash</code>值也不会改变。这样既能提高二次构建速度，又能不影响用户的浏览器缓存。
为何配置文件名时在<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Foutput%2F%23template-strings" target="_blank" rel="noopener noreferrer">取值占位符<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>里使用</strong>[contenthash]<strong>而不是</strong>[chunkhash]<strong>呢？
<code>chunkhash</code>是 <code>chunk</code> 级别的 <code>hash</code> 值。但在项目中我们通常的做法是把<code>css</code> 都抽离出来，作为模块import到对应的 <code>js</code> 文件中。如果使用</strong>[chunkhash]<strong>，两个关联的 <code>js</code> 和 <code>css</code> 文件名的 <code>hash</code> 值是一样的。一旦其中一个改动了，与其关联的另一个文件即使毫无变化，文件名也会改变，缓存也就失效了。
而</strong>[contenthash]**，只关注文件本身，自身内容不变，hash 值也不会变。</p> <p>其余剩下的基本就是我们的业务代码，改动频率就很大了，是每次发布版本都会变的。</p> <p><img src="/my-blog/webpack/1669732833078-9def05b6-1d15-47ec-8188-1252af7de665.webp" alt="img"></p> <h3 id="常用的代码分离与方法"><a href="#常用的代码分离与方法" class="header-anchor">#</a> 常用的代码分离与方法</h3> <ul><li><strong>入口起点</strong>：通过 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fentry-context%2F%23entry" target="_blank" rel="noopener noreferrer">entry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置手动地分离代码。</li> <li><strong>防止重复</strong>：使用 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fentry-context%2F%23dependencies" target="_blank" rel="noopener noreferrer">Entry dependencies<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者 内置插件 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fplugins%2Fsplit-chunks-plugin" target="_blank" rel="noopener noreferrer">SplitChunksPlugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 去重和分离 chunk。</li> <li><strong>动态导入</strong>：通过异步引入模块(如import('./m.js'))来分离代码。</li></ul> <h3 id="webpackchunkname"><a href="#webpackchunkname" class="header-anchor">#</a> webpackChunkName</h3> <p>异步加载的 chunk 无法通过 webpack 配置自定义打包后的名称，默认都是以0、1、2...这样的数字命名。
魔法注释可以帮助我们自定义异步 chunk 名。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;route-login&quot; */</span> <span class="token string">'@/views/login'</span><span class="token punctuation">)</span>
<span class="token function">如果想把某个路由下的所有组件都打包在同一个异步块</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> 中。那么在webpackChunkName注释提供相同的 chunk name 即可。

Webpack 会将任何一个异步模块与相同的块名称组合到相同的异步块中。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果想把某个路由下的所有组件都打包在同一个异步块 (chunk) 中。那么在webpackChunkName注释提供相同的 chunk name 即可。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;group-foo&quot; */</span> <span class="token string">'./Foo.vue'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Bar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;group-foo&quot; */</span> <span class="token string">'./Bar.vue'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Baz</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;group-foo&quot; */</span> <span class="token string">'./Baz.vue'</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>Webpack</code> 会将任何一个异步模块与相同的块名称组合到相同的异步块中。</p> <h4 id="splitchunksplugin配置详解"><a href="#splitchunksplugin配置详解" class="header-anchor">#</a> <code>SplitChunksPlugin</code>配置详解</h4> <p>先看下	**<code>SplitChunksPlugin</code>**插件的默认配置，再结合实例来搞懂每个配置项真正的用处。
<code>webpack</code> 上的文档地址：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fplugins%2Fsplit-chunks-plugin%2F" target="_blank" rel="noopener noreferrer">【SplitChunksPlugin API】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 加上入口和输出的配置，以便结合实际说明</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'./src/a'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">admin</span><span class="token operator">:</span> <span class="token string">'./src/b'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash:6].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash:8].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 2. 处理的 chunk 类型</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token comment">// 4. 允许新拆出 chunk 的最小体积</span>
      <span class="token literal-property property">minRemainingSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 5. 拆分前被 chunk 公用的最小次数</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 7. 每个异步加载模块最多能被拆分的数量</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 6. 每个入口和它的同步依赖最多能被拆分的数量</span>
      <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token comment">// 8. 强制执行拆分的体积阈值并忽略其他限制</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 1. 缓存组</span>
        <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 1.1 模块路径/文件名匹配正则</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 1.2 缓存组权重</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 1.3 复用已被拆出的依赖模块，而不是继续包含在该组一起生成</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 5. default 组的模块必须至少被 2 个 chunk 共用 (本次分割前) </span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><ol><li>cacheGroups</li></ol> <p><strong>核心配置</strong> - 缓存组，可以继承/覆盖来自<code>splitChunks.*</code>的任何选项。它自身拥有<code>test</code>、<code>priority</code> 和 <code>reuseExistingChunk</code> 三个配置项。
<code>splitChunksPlugin</code> 就是根据<code>cacheGroups</code>去拆分模块的，后面2. 3. ...等其余属性其实是<strong>应用到每一个缓存组的公共配置，同样的参数以缓存组的值为准</strong>。</p> <p>把默认缓存组<code>defaultVendors</code>或<code>default</code>设置为 false，即可禁用对应缓存组规则。
模块必须符合某个缓存组的所有条件，才会被分割。</p> <p>1.1 test 模块匹配规则，可以匹配模块资源绝对路径(函数或正则)或 chunk 名称(字符串)，匹配 chunk 名称时(如'app')，将选择 chunk 中的所有模块。
可选值：function (module, { chunkGraph, moduleGraph }) =&gt; boolean | RegExp | string</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 1. 正则匹配示例，把 react 和 react-dom 分到一个名为 `lib-react` 的 js 中</span>
    <span class="token comment">// `[\\/]` 是作为跨平台兼容性的路径分隔符</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](react|react-dom)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'lib-react'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">svgIcon</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 2. 函数匹配示例，把自定义 svg 图标都拆出来，放到 `svgIcon.js` 中</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// `module.resource` 是文件的绝对路径</span>
      <span class="token comment">// 用`path.sep` 代替 / or \，以便跨平台兼容</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// path 一般会在配置文件引入，此处只是说明 path 的来源，实际并不用加上</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token comment">// 匹配 icon 文件夹下的 .svg 后缀文件</span>
        module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
        module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.svg'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>sep<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">icons</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>sep<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'svgIcon'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>1.2 priority ：
<number> 默认值：-20
缓存组打包的优先级/权重，<code>数值大</code>的优先。
一个模块同时满足多个缓存组的条件，会优先考虑权重最高的那个缓存组。
默认组的优先级为负，以允许自定义组获得更高的优先级 (自定义组的默认值为0)。</number></li> <li>1.3 reuseExistingChunk
<boolean> 默认值：true
如果当前 chunk 包含已从主 chunk 中拆分出的模块，那么缓存组不会在新 chunk 内生成这个/些模块，而是去复用被拆出的 module。
这可能会影响 chunk 的结果文件名。</boolean></li></ul> <ol><li>chunks</li></ol> <p><string> 默认值：&quot;async&quot;
选择进行代码分割的 chunk 类型，可选值：&quot;all&quot; | &quot;async&quot;(异步) | &quot;initial&quot;(同步)</string></p> <p>默认配置只会对按需加载的代码进行分割。那么入口文件同步依赖的第三方包和公共模块是无法拆出来的。因此通常会将<code>SplitChunk</code>整体的值设置为&quot;all&quot;，把初始加载的代码也加入到分割的“受众”中来。在具体缓存组如有需要再按实际情况再覆盖。
如果设为&quot;initial&quot;，那么该缓存组只会分离应用初始加载需要的包。有时这是有必要的，因为设为一味设为&quot;all&quot;的话，打包出来的 js 都会在应用初始载入时加载，即使里面包含一些首页用不到的模块。</p> <ol><li>automaticNameDelimiter</li></ol> <p><string>默认值：'~'</string></p> <p>此选项可以指定生成名称中的分隔符。</p> <p>默认情况下，若未用cacheGroups.{cacheGroup}.name自定义 chunk 名， webpack 会使用 	chunk 的缓存组名和entry来源生成 chunk 名(例如default~index.js、defaultVendors~admin.js）。</p> <ol><li>minSize</li></ol> <p><number>默认值：20000</number></p> <p>生成chunk的最小体积（以bytes为单位）</p> <p>新拆出的 chunk 的体积最小值，也就是符合缓存组其他条件的前提下，体积大于等于这个值的模块/模块集合才会被拆分出来。
比如我们有两个入口 chunk，各自都包含了一个模块m(或者均有m1和m2)，本来符合默认配置中的default缓存组，但由于这个模块(或者m1加上m2)体积不足 20kb，便无法被输出为一个文件。</p> <p>⚠️ 即使不匹配任何一个缓存组，在 splitChunks.* 的<strong>minSize</strong>选项会影响<strong>异步 chunk</strong>。规则是<strong>体积大于<strong><strong>minSize</strong></strong>值的公共模块会被拆出</strong>。(除非 splitChunks.* chunks: 'initial'，才没有这种影响)
公共模块即 &gt;= 2个异步 chunk 共享的模块，同minChunks: 2。</p> <ol><li>minChunks</li></ol> <p><number>默认值为：1</number></p> <p>拆分前必须<strong>共享模块的最小 chunks 数</strong>。</p> <p>比如数值是2，那么在符合某个缓存组其他规则的前提下，拆分前必须有 2 个 chunk 共用了这个模块，才可以被归到这个组下拆分出来。
不是文件共享而是 <strong>chunk 共享</strong>，所以清楚 SplitChunksPlugin 处理前 chunk 的分包情况非常有必要。</p> <ol><li>maxInitialRequests</li></ol> <p><number> 默认值： 30</number></p> <p>每个入口点的最大并行请求数。</p> <p>也就是<strong>每个入口和它的同步依赖</strong>最多够被拆分/合并成几个js文件。对这个数量进行限制为的是避免初始js请求过多。</p> <p>注意几点：</p> <ul><li>入口文件本身算一个请求</li> <li>如单独拆出了runtimeChunk，不算在内</li> <li>单独拆出的css文件不算在内</li> <li>若同时有两个模块满足cacheGroup规则要进行拆分，但maxInitialRequests只允许再拆出一个文件，那么体积较大的模块会被拆分出来。</li></ul> <ol><li>maxAsyncRequests</li></ol> <p><number> 默认值：30</number></p> <p>每个按需加载模块的最大并行请求数。</p> <p>也就是<strong>一个异步加载模块和它的同步依赖</strong>最多能被拆分成几个js。除了处理对象不同，应该很好理解。</p> <p>注意几点：</p> <ul><li>import()文件本身算一个请求</li> <li>同样不算js以外的公共资源请求如css</li> <li>若同时有两个模块满足cacheGroup规则要进行拆分，但maxAsyncRequests只允许再拆出一个文件，那么体积较大的模块会被拆分出来。</li></ul> <ol><li>enforceSizeThreshold</li></ol> <p><number> 默认值： 50</number></p> <p>如果符合缓存组其他条件(不包括下面三项)的模块/模块集超过这个体积阈值，就忽略minRemainingSize, maxAsyncRequests, maxInitialRequests的配置，总是为这个缓存组创建 chunk。
也就是说即使超出了maxAsyncRequests或maxInitialRequests指定的可拆分次数，只要缓存组模块体积大于50kb，仍然会分出新 chunk。</p> <h3 id="拆包"><a href="#拆包" class="header-anchor">#</a> 拆包</h3> <h4 id="文件以内容摘要-hash-值命名以实现持久缓存"><a href="#文件以内容摘要-hash-值命名以实现持久缓存" class="header-anchor">#</a> 文件以内容摘要 hash 值命名以实现持久缓存</h4> <p>通过对output.filename和output.chunkFilename的配置，利用[contenthash]占位符，为js文件名加上根据其内容生成的唯一 hash 值，<strong>轻松实现资源的长效缓存</strong>。也就是说，无论是第几次打包，内容没有变化的资源 (如js、css) 文件名永远不会变，而那些有修改的文件就会生成新的文件名 (hash 值) 。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash:6].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'[name].[contenthash:8].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>如果是 webpack 4，还需要分别固定****moduleId</strong>和<strong>chunkId</strong>，以保持名称的稳定性**。
因为 webpack 内部维护了一个自增的数字 id，每个 module 都有一个 id。当增加或删除 module 的时候，id 就会变化，导致其它 module 虽然内容没有变化，但由于 id 被强占，只能自增或者自减，导致整个项目的 module id 的顺序都错乱了。
也就是说，如果引入了一个新模块或删掉一个模块，都可能<strong>导致其它文件的 moduleId 发生改变，相应地文件内容也就改变，缓存便失效了</strong>。
同样地，chunk 的新增/减少也会导致 chunk id 顺序发生错乱，那么原本的缓存就不作数了。</p> <p><strong>解决办法：</strong></p> <ul><li><strong>moduleId</strong>：
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fv4.webpack.docschina.org%2Fplugins%2Fhashed-module-ids-plugin%2F" target="_blank" rel="noopener noreferrer">HashedModuleIdsPlugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>插件 (webpack 4) → <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Foptimization%2F%23optimizationmoduleids" target="_blank" rel="noopener noreferrer">optimization.moduleIds: 'deterministic'<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (webpack 5)
在<code>webpack 5</code>无需额外配置，使用默认值就好。</li> <li><strong>chunkId</strong>：
<a href="">NamedChunksPlugin</a>插件 (webpack 4) → <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Foptimization%2F%23optimizationchunkids" target="_blank" rel="noopener noreferrer">optimization.chunkIds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (webpack 5)
但这个方法只对命名 chunk 有效，我们的懒加载页面生成的 chunk 还需要额外设置，如vue-cli 4的处理：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// node_modules/@vue/cli-service/lib/config/app.js</span>
<span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  config
    <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'named-chunks'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/NamedChunksPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> chunk<span class="token punctuation">.</span>name
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hash-sum'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> joinedHash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>
          Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>modulesIterable<span class="token punctuation">,</span> <span class="token parameter">m</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chunk-</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> joinedHash
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在 webpack 5 optimization.chunkIds默认开发环境'named'，生产环境'deterministic'，因此我们<strong>无需设置该配置项。而且 webpack 5 更改了 id 生成算法，异步 chunk 也能轻松拥有固定的 id 了</strong>。</p> <h5 id="至于图片和-css-文件"><a href="#至于图片和-css-文件" class="header-anchor">#</a> 至于图片和 CSS 文件</h5> <ul><li>CSS 是通过 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fplugins%2Fmini-css-extract-plugin%2F" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件的filename和chunkFilename定义文件名，值用 hash 占位符如[contenthash:8]实现缓存配置的。</li> <li>而图片文件，是在 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffile-loader" target="_blank" rel="noopener noreferrer">file-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 name 配置项用[contenthash]处理的。
注 ⚠️：webpack 5 废弃了 file-loader，改用 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fasset-modules%2F%23custom-output-filename" target="_blank" rel="noopener noreferrer">output.assetModuleFilename<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 定义图片字体等资源文件的名称，如assetModuleFilename: 'images/[contenthash][ext][query]'。</li></ul> <h4 id="splitchunksplugin-拆包实战"><a href="#splitchunksplugin-拆包实战" class="header-anchor">#</a> SplitChunksPlugin 拆包实战</h4> <h5 id="vue-cli-4-默认处理"><a href="#vue-cli-4-默认处理" class="header-anchor">#</a> vue-cli 4 默认处理</h5> <p>结合<code>vue-cli 4</code> 搭的项目，来看下 <code>vue-cli</code> 通过 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcli.vuejs.org%2Fzh%2Fguide%2Fwebpack.html%23%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C-%E9%AB%98%E7%BA%A7" target="_blank" rel="noopener noreferrer">chainWebpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 覆盖掉 <code>SplitChunksPlugin cacheGroups</code>项默认值的配置(整理后)：
(vue-cli chainWebpack配置处大致是node_modules/@vue/cli-service/lib/config/app.js:38)</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'static/js/[name].[contenthash:8].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'static/js/[name].[contenthash:8].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 只处理异步 chunk，这里两个缓存组都另配了 chunks，那么就被无视了 </span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 允许新拆出 chunk 的最小体积</span>
      <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 旨在与 HTTP/2 和长期缓存一起使用。它增加了请求数量以实现更好的缓存。它还可以用于减小文件大小，以加快二次构建速度。</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 拆分前被 chunk 公用的最小次数</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 每个异步加载模块最多能被拆分的数量</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 每个入口和它的同步依赖最多能被拆分的数量</span>
      <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存组</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chunk-vendors</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 缓存组权重，数字越大优先级越高</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span> <span class="token comment">// 只处理初始 chunk</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">common</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chunk-common</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// common 组的模块必须至少被 2 个 chunk 共用 (本次分割前) </span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span> <span class="token comment">// 只针对同步 chunk</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 复用已被拆出的依赖模块，而不是继续包含在该组一起生成</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>运行打包后，发现入口文件依赖的第三方包被全数拆出放进了<code>chunk-vendors.js</code>，剩下的同步依赖都被打包进了<code>app.js</code>，而其他都是懒加载组件生成的异步 chunk。并没有打包出所谓的公共模块合集<code>chunk-common.js</code>。(module 被两个以上chunk所应用，那么拆分module 生成打包文件)</p> <p>解读下此配置的拆分实现：</p> <ol><li>入口来自 node_modules 文件夹的同步依赖放入chunk-vendors；</li> <li>被至少 2 个 同步 chunk 共享的模块放入chunk-common；</li> <li>符合每个缓存组其他条件的情况下，能拆出的模块整合后的体积必须大于30kb(<em>在进行 min+gz 之前的体积</em>)。<strong>小了不生成新 chunk</strong>。</li> <li>每个异步引入模块并行请求的数量 (即它本身和它的同步依赖被拆分成的 js 个数)不能多于5个；每个入口文件和它的同步依赖最多能被拆成3个 js。</li> <li>即使不匹配任何一个缓存组，splitChunks.* 级别的最小 chunk 属性minSize也会影响所有<strong>异步 chunk</strong>，效果是<strong>体积大于minSize值的公共模块（大于等于2个异步chunk引用的模块）会被拆出</strong>。(除非 splitChunks.* chunks: 'initial')
公共模块即 &gt;= 2个异步 chunk 共享的模块，同minChunks: 2。</li></ol> <h3 id="拆包优化"><a href="#拆包优化" class="header-anchor">#</a> 拆包优化</h3> <ul><li><p><strong>基础类库 chunk-libs</strong>
构成项目必不可少的一些基础类库，如<code>vue</code>+<code>vue-router</code>+<code>vuex</code>+<code>axios</code> 这种标准的全家桶，它们的升级频率都不高，但每个页面都需要它们。(一些全局被共用的，体积不大的第三方库也可以放在其中：比如<code>nprogress</code>、<code>js-cookie</code>等)</p></li> <li><p><strong>UI 组件库</strong>
理论上 UI 组件库也可以放入 libs 中，但它实在是过大，不管是Element-UI还是Ant Designgzip 压缩完都要 200kb 左右，可能比 libs 里所有的包加起来还要大不少，而且 UI 组件库的更新频率也相对比 libs 要更高一点。我们会及时更新它来解决一些现有的 bugs 或使用一些新功能。<strong>所以建议将 UI 组件库单独拆成一个包</strong>。</p></li> <li><p><strong>自定义组件/函数 chunk-commons</strong>
这里的 commons 分为 必要和非必要。
**必要组件是指那些项目里必须加载它们才能正常运行的组件或者函数。**比如你的路由表、全局 state、全局侧边栏/Header/Footer 等组件、自定义 Svg 图标等等。这些其实就是你在入口文件中依赖的东西，它们都会默认打包到app.js中。
非必要组件是指被大部分懒加载页面使用，但在入口文件 entry 中未被引入的模块。比如：一个管理后台，你封装了很多select或者table组件，由于它们的体积不会很大，它们都会被默认打包到到每一个懒加载页面的 chunk 中，这样会造成不少的浪费。你有十个页面引用了它，就会包重复打包十次。所以应该将那些被大量共用的组件单独打包成chunk-commons。
不过还是要结合具体情况来看。一般情况下，你也可以将那些<em>非必要组件/函数</em>也在入口文件 entry 中引入，和<em>必要组件/函数</em>一同打包到app.js之中也是没什么问题的。</p></li> <li><p><strong>低频组件</strong>
低频组件和上面的自定义公共组件 chunk-commons 最大的区别是，它们只会在一些特定业务场景下使用，比如富文本编辑器、js-xlsx前端 excel 处理库等。一般这些库都是第三方的且大于30kb (缓存组外的默认minSize值)，也不会在初始页加载，所以 webpack 4 会默认打包成一个独立的 js。一般无需特别处理。小于minSize的情况会被打包到具体使用它的页面 js (异步 chunk) 中。</p></li> <li><p><strong>业务代码</strong>
就是我们平时经常写的业务代码。一般都是按照页面的划分来打包，比如在 vue 中，使用<a href="https://links.jianshu.com/go?to=https%3A%2F%2Frouter.vuejs.org%2Fzh%2Fguide%2Fadvanced%2Flazy-loading.html" target="_blank" rel="noopener noreferrer">路由懒加载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的方式加载页面 component: () =&gt; import('./Guide.vue') webpack 默认会将它打包成一个独立的异步加载的 js。</p></li></ul> <p>再回观我们之前的<code>app.js</code>和<code>chunk-vendors.js</code>。它们都是初始加载的<code>js</code>，由于体积太大需要在合理范围内拆分成更小一些的 <code>js</code>，以利用浏览器的并发请求，优化首页加载体验。</p> <ul><li>为了缩减初始代码体积，通常只抽入口依赖的第三方、另行处理懒加载页面的库依赖更为合理。而我的项目中除了重复的一个，异步模块无其他第三方引入。就简单交由commons缓存组去处理。vue 我通过 webpack 的 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fexternals%2F%23externals" target="_blank" rel="noopener noreferrer">externals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配了 CDN，故没有打包进来。</li> <li>chunk-vendors.js的Element-UI组件库应单独分出为chunk-elementUI.js，由于它包含在第三方包的缓存组内，要给它设置比libs更高的优先级。</li> <li>app.js中图标占了大头可以单独抽出来，把自定义 svg 都放到 chunk-svgIcon.js 中；</li> <li>备一个优先级最低的chunk-commons.js，用于处理其他公共组件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token comment">// 允许新拆出 chunk 的最小体积，也是异步 chunk 公共模块的强制拆分体积</span>
  <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 每个异步加载模块最多能被拆分的数量</span>
  <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 每个入口和它的同步依赖最多能被拆分的数量</span>
  <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token comment">// 强制执行拆分的体积阈值并忽略其他限制</span>
  <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">libs</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 第三方库</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;chunk-libs&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span> <span class="token comment">// 只打包初始时依赖的第三方</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">elementUI</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// elementUI 单独拆包</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;chunk-elementUI&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]element-ui[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token comment">// 权重要大于 libs</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">svgIcon</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// svg 图标</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'chunk-svgIcon'</span><span class="token punctuation">,</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// `module.resource` 是文件的绝对路径</span>
        <span class="token comment">// 用`path.sep` 代替 / or \，以便跨平台兼容</span>
        <span class="token comment">// const path = require('path') // path 一般会在配置文件引入，此处只是说明 path 的来源，实际并不用加上</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
          module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.svg'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>sep<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">icons</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span>sep<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">30</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 公共模块包</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chunk-commons</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>好了，这大概就是<code>splitChunk</code>的内容，我们修改下<code>webpack.prod.ts</code></p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
      minSize<span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token comment">// 允许新拆出 chunk 的最小体积，也是异步 chunk 公共模块的强制拆分体积</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 每个异步加载模块最多能被拆分的数量</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 每个入口和它的同步依赖最多能被拆分的数量</span>
      enforceSizeThreshold<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token comment">// 强制执行拆分的体积阈值并忽略其他限制</span>
      <span class="token comment">// 分隔代码</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        libs<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 提取node_modules代码</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 只匹配node_modules里面的模块</span>
          name<span class="token operator">:</span> <span class="token string">'chunk-libs'</span><span class="token punctuation">,</span> <span class="token comment">// 提取文件命名为vendors,js后缀和chunkhash会自动加</span>
          chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span> <span class="token comment">// 只提取初始化就能获取到的模块,不管异步的</span>
          priority<span class="token operator">:</span> <span class="token number">10</span> <span class="token comment">// 提取优先级为1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 公共模块包，同步模块 chunks 包含同步和异步</span>
        commons<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'chunk-commons'</span><span class="token punctuation">,</span> <span class="token comment">// 提取文件命名为commons</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 只要使用两次就提取出来</span>
          minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 提取代码体积大于0就提取出来</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 复用已被拆出的依赖模块，而不是继续包含在该组一起生成</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 作用是将包含chunks映射关系的list单独从app.js里提取出来，因为每一个chunk的id基本都是基于内容hash出来的，每次改动都会影响hash值，如果不将其提取，造成每次app.js都会改变。缓存失效  </span>
    runtimeChunk<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'runtime'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CssMinimizerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩css</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启多线程压缩</span>
        terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          compress<span class="token operator">:</span> <span class="token punctuation">{</span>
            pure_funcs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'console.log'</span><span class="token punctuation">,</span> <span class="token string">'debugger'</span><span class="token punctuation">]</span> <span class="token comment">// 删除console.log</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">6/9/2023, 4:06:17 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/my-blog/blogs/Webpack/mf.html" class="prev">
          webpack系列-第六篇
        </a></span> <span class="next"><a href="/my-blog/blogs/Webpack/theory.html">
          webpack系列-第三篇
        </a></span></p></div> <div class="comments-wrapper" style="display:none;"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_1-前言" class="sidebar-link reco-side-_1-前言" data-v-b57cc07c>1. 前言</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_2-构建进度美化" class="sidebar-link reco-side-_2-构建进度美化" data-v-b57cc07c>2. 构建进度美化</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_3-持久化缓存" class="sidebar-link reco-side-_3-持久化缓存" data-v-b57cc07c>3. 持久化缓存</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_4-include-exclude-缩小构建目标" class="sidebar-link reco-side-_4-include-exclude-缩小构建目标" data-v-b57cc07c>4. include&amp;exclude 缩小构建目标</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_5-devtools配置" class="sidebar-link reco-side-_5-devtools配置" data-v-b57cc07c>5. devtools配置</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_6-打包体积分析" class="sidebar-link reco-side-_6-打包体积分析" data-v-b57cc07c>6. 打包体积分析</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_7-css抽离-压缩" class="sidebar-link reco-side-_7-css抽离-压缩" data-v-b57cc07c>7. css抽离&amp;压缩</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_8-js压缩" class="sidebar-link reco-side-_8-js压缩" data-v-b57cc07c>8. js压缩</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_9-文件指纹" class="sidebar-link reco-side-_9-文件指纹" data-v-b57cc07c>9. 文件指纹</a></li><li class="level-2" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#_10-代码分割splitchunk" class="sidebar-link reco-side-_10-代码分割splitchunk" data-v-b57cc07c>10. 代码分割splitChunk</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#webpack-chunk分包原理" class="sidebar-link reco-side-webpack-chunk分包原理" data-v-b57cc07c>webpack chunk分包原理</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#why-how-为何要代码分割以及如何分割" class="sidebar-link reco-side-why-how-为何要代码分割以及如何分割" data-v-b57cc07c>why &amp; how? 为何要代码分割以及如何分割</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#常用的代码分离与方法" class="sidebar-link reco-side-常用的代码分离与方法" data-v-b57cc07c>常用的代码分离与方法</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#webpackchunkname" class="sidebar-link reco-side-webpackchunkname" data-v-b57cc07c>webpackChunkName</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#拆包" class="sidebar-link reco-side-拆包" data-v-b57cc07c>拆包</a></li><li class="level-3" data-v-b57cc07c><a href="/my-blog/blogs/Webpack/performance.html#拆包优化" class="sidebar-link reco-side-拆包优化" data-v-b57cc07c>拆包优化</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/my-blog/assets/js/app.32be202e.js" defer></script><script src="/my-blog/assets/js/3.a0eaa787.js" defer></script><script src="/my-blog/assets/js/1.f46f4f66.js" defer></script><script src="/my-blog/assets/js/17.3fa23e44.js" defer></script>
  </body>
</html>
